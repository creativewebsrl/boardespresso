{% extends "layout.html" %}

{% block content %}

<div id="dashboard">
    <div class="g-cell" style="background-color:red"></div>
</div>

{% endblock %}


{% block javascript %}
{% parent %}

<script type="text/javascript" src="/js/jss.js"></script>

<script type="text/javascript">
$(document).ready(function($){
    
    /**
     * Make a grid at elemOrSelector
     */
    function create_grid(elemOrSelector,options) {
        
        /*
        
        ###########
        #    #    # <- # is the gutter
        #    #    #
        ###########
        #    #    # <- square side
        #    #    # <- square side
        ###########
        
        */
        
        var o = $.extend({
            rows  : 12,
            ratio : 16/10, // 16/10 work on 16/9 too, but not the other way around
            sizeTarget : window,
            drawBackground : true,
            heightRatio : 1,
            gutterAmp : 10  // % of square side, is the distance between squares
            
        },options || {});
        
        $(o.sizeTarget).resize(function(){
            
            var $grid = $(elemOrSelector),
                rows = o.rows,
                ratio = o.ratio, 
                height = $(o.sizeTarget).height() * o.heightRatio, // take less to ensure do not trigger scroll
                maxWidth = height*ratio,
                gutterAmp = o.gutterAmp,
                
                pixTo1amp = height / ( (gutterAmp+100)*rows+gutterAmp ),
                
                squareSide =  pixTo1amp * 100,  // square side in pixels
                gutterWidth = (height-squareSide*rows)/(rows+1), // gutter width in pixels
                squareAmp = squareSide*100/height, // percent of the side of the square respect to the height
                gutterRealAmp = gutterWidth*100/height // percent of the gutter width respect to the height
                
                // set the width so that it holds the maximum number of squares at this ratio
                width = Math.floor((maxWidth-gutterWidth) / (squareSide+gutterWidth))*(squareSide+gutterWidth)+gutterWidth,
                tmpSize = null,
                tmpPos = null
                ;
                
            $grid.height(height);
            $grid.width(width);
            
            $grid.css('position','relative');
            
            jss('.g-cell', {
                position:'absolute'
            });
            
            for(var i=1;i<rows*2+1;i++){
                
                tmpSize = (squareSide+gutterWidth)*i-gutterWidth;
                tmpPos = gutterWidth+(squareSide+gutterWidth)*(i-1);
                
                jss('.g-pos-x-'+i, {
                    left: tmpPos+'px'
                });
                
                jss('.g-width-'+i, {
                    width: tmpSize+'px'
                });
                
                if (i>rows) continue; // avoid unnecessary classes for height 
                
                jss('.g-height-'+i, {
                    height: tmpSize+'px'
                });
                
                jss('.g-pos-y-'+i, {
                    top: tmpPos+'px'
                });
                
            }
            
            if (o.drawBackground) {
                // the background image is a square with a border at left and bottom.
                // The border is wide as 'gutterWith', wich at present is wide 10%
                // of the square side
                $grid.css('background-size',''+(squareSide+gutterWidth)+'px '+(squareSide+gutterWidth)+'px');
                $grid.css('background-image','url(/images/dashboard_bg.png');
            }
        
        }).resize();
        
    }
    
    create_grid('#dashboard');
    
});
</script>
{% endblock %}

{% block stylesheet %}
{% parent %}
<style type="text/css">

html,body {
    height: 100%;
    margin:0;
    padding:0;
}

body {
    background-color: #C8CFD0;
}

#dashboard {
    margin: 0 auto;
}


</style>
{% endblock %}